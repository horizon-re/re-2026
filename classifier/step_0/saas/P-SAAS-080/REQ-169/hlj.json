{
  "doc_id": "f9370a50-5856-5d3d-8716-7e9f7dbaf705",
  "req_key": "saas::P-SAAS-080::REQ-169",
  "req_id": "REQ-169",
  "domain": "saas",
  "prompt_id": "P-SAAS-080",
  "source": {
    "raw_path": "02_raw_requirements/saas/P-SAAS-080/req-169_raw.txt",
    "refined_path": "03_refined_json_normalized/saas/P-SAAS-080/req-169_refined.json",
    "origin": "both"
  },
  "text": "Issue  \nThe QASM compiler’s current grammar permits register declarations with indices that are non-integer or negative values (e.g., `qreg q[-1]; qreg q[1.5]; qreg q[π];`). These invalid indices lead to undefined behavior in later compilation stages, causing unpredictable runtime faults and hindering compiler reliability. Because the lexer does not distinguish integer-only index tokens, invalid inputs slip through and produce ambiguous errors downstream rather than a targeted diagnostic. This defect has been observed in both development and production builds, leading to delayed deployment cycles.\n\nValidation  \nIntroduce a fast-fail lexer rule that matches any array index token not conforming to the pattern of one or more decimal digits (regex `\\d+`). On encountering a bracketed index that fails this pattern, the lexer should immediately raise error code QASM102 (“Invalid QASM index: must be integer ≥ 0”), halting further parsing. Add a unit test case where a register declaration uses the Unicode constant π as an index (`qreg q[π];`) and assert that lexing fails with QASM102. Also include negative and floating-point index tests (`qreg q[-1]; qreg q[2.3];`) to ensure comprehensive coverage.\n\nPatch  \nIn `lexer.l`, insert the following rule before the integer rule:  \n```\n\\[\\s*([^\\d][^\\]]*)\\s*\\]    { return error(QASM102, \"Index must be integer ≥ 0\"); }\n```  \nRefactor the existing integer-index rule to match `\\[\\s*\\d+\\s*\\]`. Extend the unit test suite (e.g., `test/lexer_invalid_index.qasm`) with tests:  \n```\nqreg q[π];    // expect QASM102  \nqreg q[-1];   // expect QASM102  \nqreg q[2.3];  // expect QASM102  \n```  \nRun `make test` to confirm failure on invalid cases and success on valid declarations.",
  "structured_data": [
    {
      "id": "REQ-169-HLJ-Chunk_1-Item_1-v1.0",
      "domain": "unknown",
      "summary": "Introduce fast-fail lexer rule for non-digit indices",
      "priority": "High",
      "tags": [
        "fast_fail",
        "lexer",
        "QASM"
      ],
      "subdomain": "compiler",
      "difficulty": 3,
      "additionalNotes": "",
      "source_hlj_id": "REQ 001-001",
      "domain_id": "P-SAAS-080"
    },
    {
      "id": "REQ-169-HLJ-Chunk_1-Item_2-v1.0",
      "domain": "unknown",
      "summary": "Raise error code QASM102 on invalid indices",
      "priority": "High",
      "tags": [
        "error_handling",
        "QASM"
      ],
      "subdomain": "compiler",
      "difficulty": 3,
      "additionalNotes": "",
      "source_hlj_id": "REQ 001-002",
      "domain_id": "P-SAAS-080"
    },
    {
      "id": "REQ-169-HLJ-Chunk_1-Item_3-v1.0",
      "domain": "unknown",
      "summary": "Halt parsing upon invalid index detection",
      "priority": "High",
      "tags": [
        "parsing",
        "QASM"
      ],
      "subdomain": "compiler",
      "difficulty": 3,
      "additionalNotes": "",
      "source_hlj_id": "REQ 001-003",
      "domain_id": "P-SAAS-080"
    },
    {
      "id": "REQ-169-HLJ-Chunk_1-Item_4-v1.0",
      "domain": "unknown",
      "summary": "Add unit test for π index failure",
      "priority": "High",
      "tags": [
        "unit_test",
        "QASM",
        "π_index"
      ],
      "subdomain": "compiler",
      "difficulty": 2,
      "additionalNotes": "origin: implied",
      "source_hlj_id": "REQ 001-004",
      "domain_id": "P-SAAS-080"
    },
    {
      "id": "REQ-169-HLJ-Chunk_1-Item_5-v1.0",
      "domain": "unknown",
      "summary": "Add unit test for negative index failure",
      "priority": "High",
      "tags": [
        "unit_test",
        "QASM",
        "negative_index"
      ],
      "subdomain": "compiler",
      "difficulty": 2,
      "additionalNotes": "origin: implied",
      "source_hlj_id": "REQ 001-005",
      "domain_id": "P-SAAS-080"
    },
    {
      "id": "REQ-169-HLJ-Chunk_1-Item_6-v1.0",
      "domain": "unknown",
      "summary": "Refactor lexer rule for integer-index tokens",
      "priority": "Medium",
      "tags": [
        "refactoring",
        "lexer",
        "QASM"
      ],
      "subdomain": "compiler",
      "difficulty": 4,
      "additionalNotes": "",
      "source_hlj_id": "REQ 001-006",
      "domain_id": "P-SAAS-080"
    },
    {
      "id": "REQ-169-HLJ-Chunk_1-Item_7-v1.0",
      "domain": "unknown",
      "summary": "Extend unit tests for floating-point index failure",
      "priority": "Medium",
      "tags": [
        "unit_test",
        "QASM",
        "floating_point_index"
      ],
      "subdomain": "compiler",
      "difficulty": 3,
      "additionalNotes": "origin: implied",
      "source_hlj_id": "REQ 001-007",
      "domain_id": "P-SAAS-080"
    },
    {
      "id": "REQ-169-HLJ-Chunk_1-Item_8-v1.0",
      "domain": "unknown",
      "summary": "Implement UTC timestamping for message indices",
      "priority": "High",
      "tags": [
        "timestamping",
        "QASM"
      ],
      "subdomain": "compiler",
      "difficulty": 4,
      "additionalNotes": "",
      "source_hlj_id": "REQ 001-008",
      "domain_id": "P-SAAS-080"
    },
    {
      "id": "REQ-169-HLJ-Chunk_1-Item_9-v1.0",
      "domain": "unknown",
      "summary": "Include DST flag in message header",
      "priority": "Medium",
      "tags": [
        "timestamping",
        "QASM",
        "DST_flag"
      ],
      "subdomain": "compiler",
      "difficulty": 3,
      "additionalNotes": "",
      "source_hlj_id": "REQ 001-009",
      "domain_id": "P-SAAS-080"
    },
    {
      "id": "REQ-169-HLJ-Chunk_1-Item_10-v1.0",
      "domain": "unknown",
      "summary": "Log invalid index errors to designated log file",
      "priority": "Medium",
      "tags": [
        "error_handling",
        "logging",
        "QASM"
      ],
      "subdomain": "compiler",
      "difficulty": 3,
      "additionalNotes": "",
      "source_hlj_id": "REQ 001-010",
      "domain_id": "P-SAAS-080"
    }
  ]
}